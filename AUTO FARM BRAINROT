local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local luckyBlocksFolder = Workspace:WaitForChild("LuckyBlocks")
local brainrotsFolder = Workspace:WaitForChild("Brainrots")
local zoneWall = Workspace:WaitForChild("InvisWalls"):WaitForChild("ZoneWall")
local remoteDamage = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("DamageBlockEvent")

_G.ValorMinimo = 4000 
_G.AutoFarmAura = true

local CONFIG = {
    MaxSpeed = 35.0, 
    FlyHeight = 50,
    WalkSpeed = 58,
    ActiveDelivery = false,
    LogoURL = "https://i.imgur.com/sGjhnTL.png",
    WebhookURL = "https://discord.com/api/webhooks/1462742171403948218/7rwuoF88qT2lS7-SxBfP4bd_4nQ152FFQ13wQK5SL86NcPb1QXW7TrSdGQfNsn_DoZ-j"
}

local PICKAXE_ORDER = {
    "Volcano", "Sea", "UFO", "Disco", "Holiday", "Glitch", "Six Seven", 
    "Angel", "Lightning", "Ancient", "Ice", "Yin Yang", "Fireworks", 
    "Galaxy", "Blood Moon", "Molten", "Radioactive", "Candy", "Beanstalk", 
    "Rainbow", "Diamond", "Gold", "Iron", "Stone", "Wood"
}

local function isCarrying()
    local val = player:GetAttribute("Carrying")
    return (val ~= nil and tostring(val) ~= "" and tostring(val):lower() ~= "none")
end

local function isBeingCarriedByOthers(brainrot)
    for _, otherPlayer in pairs(Players:GetPlayers()) do
        if otherPlayer ~= player and otherPlayer.Character and otherPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local part = brainrot:IsA("BasePart") and brainrot or brainrot:FindFirstChildWhichIsA("BasePart", true)
            if part then
                if (part.Position - otherPlayer.Character.HumanoidRootPart.Position).Magnitude < 4 then
                    return true
                end
            end
        end
    end
    return false
end

local function parseCashValue(text)
    local cleanText = text:lower():gsub("[^%d%.km]", "")
    local value = tonumber(cleanText:match("[%d%.]+"))
    if not value then return 0 end
    if cleanText:find("k") then return value * 1000
    elseif cleanText:find("m") then return value * 1000000 end
    return value
end

RunService.Heartbeat:Connect(function()
    local char = player.Character
    if not char or isCarrying() or CONFIG.ActiveDelivery then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum or hum.Health <= 0 then return end
    if not char:FindFirstChildOfClass("Tool") then
        local backpack = player.Backpack
        for _, pickName in ipairs(PICKAXE_ORDER) do
            local tool = backpack:FindFirstChild(pickName)
            if tool then
                hum:EquipTool(tool)
                break
            end
        end
    end
end)

local function sendV3NENOWebhook(itemName, itemValue, delivered, rarityText)
    local numericValue = parseCashValue(itemValue)
    local isHighValue = numericValue >= 20000
    local displayValue = "$" .. itemValue:gsub("[^%d%.kmKM]", "") .. "/s"
    local timestamp = os.date("%H:%M:%S")
    
    local data = {
        ["content"] = isHighValue and "@everyone" or "",
        ["embeds"] = {{
            ["title"] = isHighValue and "üíÄ V3NENO HUB | HIGH VALUE TARGET" or "üì¶ V3NENO HUB | DELIVERY REPORT",
            ["color"] = isHighValue and 0x010101 or 0xFF0000,
            ["thumbnail"] = { ["url"] = CONFIG.LogoURL },
            ["author"] = { ["name"] = "V3NENO HUB SYSTEM", ["icon_url"] = CONFIG.LogoURL },
            ["fields"] = {
                {["name"] = "üß† Item", ["value"] = "```" .. itemName .. "```", ["inline"] = true},
                {["name"] = "üíé Rarity", ["value"] = "```" .. tostring(rarityText):upper() .. "```", ["inline"] = true},
                {["name"] = "üí∞ Value", ["value"] = "```" .. displayValue .. "```", ["inline"] = true},
                {["name"] = "üïí Time", ["value"] = "```" .. timestamp .. "```", ["inline"] = true},
                {["name"] = "üë§ Player", ["value"] = "```" .. player.Name .. "```", ["inline"] = true},
                {["name"] = "üö¶ Status", ["value"] = delivered and "```‚úÖ DELIVERED```" or "```‚ùå FAILED```", ["inline"] = true},
                {["name"] = "üõ∞Ô∏è SERVER ID", ["value"] = "```" .. game.JobId .. "```", ["inline"] = false},
                {["name"] = "üë• Server Population", ["value"] = "```" .. #Players:GetPlayers() .. " Players```", ["inline"] = true}
            },
            ["footer"] = { ["text"] = "V3NENO ON TOP", ["icon_url"] = CONFIG.LogoURL },
            ["timestamp"] = DateTime.now():ToIsoDate()
        }}
    }
    local request = syn and syn.request or http_request or request or HttpPost
    if request then
        pcall(function()
            request({
                Url = CONFIG.WebhookURL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode(data)
            })
        end)
    end
end

task.spawn(function()
    while true do
        if _G.AutoFarmAura then
            pcall(function()
                local char = player.Character
                local root = char and char:FindFirstChild("HumanoidRootPart")
                if root and not CONFIG.ActiveDelivery then
                    local blocks = luckyBlocksFolder:GetChildren()
                    for i = 1, #blocks do
                        local block = blocks[i]
                        local target = block:IsA("BasePart") and block or block:FindFirstChildWhichIsA("BasePart", true)
                        if target and (root.Position - target.Position).Magnitude <= 30 then
                            remoteDamage:FireServer(block)
                        end
                    end
                end
            end)
        end
        task.wait(0.2)
    end
end)

local function startV3NENORun(char, root, hum, itemName, itemValue, rarityText)
    if CONFIG.ActiveDelivery then return end
    CONFIG.ActiveDelivery = true
    local connection
    connection = RunService.Stepped:Connect(function(_, dt)
        if not isCarrying() or not root or not root.Parent or char.Parent == nil then
            if connection then connection:Disconnect() end
            sendV3NENOWebhook(itemName, itemValue, false, rarityText)
            hum.Health = 0
            task.wait(0.1)
            if hum.Health > 0 then player:BreakJoints() end
            CONFIG.ActiveDelivery = false
            return
        end
        local wallPos = zoneWall.Position
        local targetPos = Vector3.new(wallPos.X, wallPos.Y + CONFIG.FlyHeight, wallPos.Z)
        local diff = targetPos - root.Position
        local dist = diff.Magnitude
        if dist > 8 then
            local direction = diff.Unit
            local moveStep = direction * CONFIG.MaxSpeed * dt
            root.CFrame = CFrame.new(root.Position + moveStep) * CFrame.lookAt(Vector3.new(0,0,0), direction)
            root.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
            root.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
        else
            if connection then connection:Disconnect() end
            root.CFrame = CFrame.new(wallPos.X, wallPos.Y + 2, wallPos.Z)
            task.wait(0.5)
            root.CFrame = root.CFrame * CFrame.new(0, 0, -20)
            sendV3NENOWebhook(itemName, itemValue, true, rarityText)
            task.wait(0.5)
            hum.Health = 0
            task.wait(0.1)
            if hum.Health > 0 then player:BreakJoints() end 
            CONFIG.ActiveDelivery = false
        end
    end)
end

task.spawn(function()
    while true do
        task.wait(0.5)
        local char = player.Character
        local root = char and char:FindFirstChild("HumanoidRootPart")
        local hum = char and char:FindFirstChild("Humanoid")
        if char and root and hum and hum.Health > 0 then
            if not CONFIG.ActiveDelivery then
                local targetBR = nil
                local foundName, foundValue, foundRarity = "Unknown", "0", "Unknown"
                local items = brainrotsFolder:GetChildren()
                for i = 1, #items do
                    local br = items[i]
                    local label = br:FindFirstChild("CharCash", true)
                    local rarityLabel = br:FindFirstChild("CharRarity", true)
                    if label then
                        local val = parseCashValue(label.Text)
                        if val >= _G.ValorMinimo and not isBeingCarriedByOthers(br) then
                            targetBR = br
                            foundName = br.Name
                            foundValue = label.Text
                            foundRarity = rarityLabel and rarityLabel.Text or "Unknown"
                            break
                        end
                    end
                end
                if targetBR and not isCarrying() then
                    local targetPart = targetBR:FindFirstChild("HumanoidRootPart") or targetBR:FindFirstChildWhichIsA("BasePart", true)
                    if targetPart then
                        root.CFrame = targetPart.CFrame
                        root.AssemblyLinearVelocity = Vector3.new(0,0,0)
                        task.wait(0.5)
                        local prompt = targetBR:FindFirstChildWhichIsA("ProximityPrompt", true)
                        if prompt then
                            prompt.HoldDuration = 0
                            fireproximityprompt(prompt)
                        end
                        task.wait(1.2)
                        if isCarrying() then
                            root.CFrame = root.CFrame * CFrame.new(0, CONFIG.FlyHeight, 0)
                            startV3NENORun(char, root, hum, foundName, foundValue, foundRarity)
                        end
                    end
                elseif not isCarrying() then
                    local closest, minDist = nil, math.huge
                    local blocks = luckyBlocksFolder:GetChildren()
                    for i = 1, #blocks do
                        local b = blocks[i]
                        pcall(function()
                            local part = b:IsA("BasePart") and b or b:FindFirstChildWhichIsA("BasePart", true)
                            if part then
                                local d = (root.Position - part.Position).Magnitude
                                if d < minDist then minDist = d closest = part end
                            end
                        end)
                    end
                    if closest then
                        hum.WalkSpeed = CONFIG.WalkSpeed
                        hum:MoveTo(closest.Position)
                    end
                end
            end
        end
    end
end)

RunService.Stepped:Connect(function()
    if player.Character then
        local descendants = player.Character:GetChildren()
        for i = 1, #descendants do
            local part = descendants[i]
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
end)
